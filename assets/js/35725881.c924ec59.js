"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([["34863"],{12210:function(e,n,i){i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>d});var r=i(10452),t=i(74848),a=i(84429);let s={title:"Announcing Ariadne Codegen!"},o,l={authorsImageUrls:[]},d=[{value:"The story",id:"the-story",level:2},{value:"Automatization",id:"automatization",level:3},{value:"Ariadne Codegen",id:"ariadne-codegen",level:2},{value:"Available options and features",id:"available-options-and-features",level:2},{value:"Known limitations",id:"known-limitations",level:2},{value:"Moving forward",id:"moving-forward",level:2}];function c(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Ariadne Codegen!",src:i(32764).A+"",width:"1980",height:"1040"})}),"\n",(0,t.jsxs)(n.p,{children:["Today we are announcing first release of ",(0,t.jsx)(n.a,{href:"https://github.com/mirumee/ariadne-codegen",children:"Ariadne Codegen"}),"!"]}),"\n",(0,t.jsx)(n.p,{children:"Ariadne Codegen is our solution for the problem of writing and maintaining a Python boilerplate code for GraphQL clients. It's a code generator that converts GraphQL queries into production ready GraphQL client for Python."}),"\n",(0,t.jsx)(n.h2,{id:"the-story",children:"The story"}),"\n",(0,t.jsxs)(n.p,{children:["Ariadne Codegen was created from our need for better solution for GraphQL Clients. At ",(0,t.jsx)(n.a,{href:"https://mirumee.com",children:"Mirumee Software"})," we are writing a lot of Python services that integrate with or extend ",(0,t.jsx)(n.a,{href:"https://graphql.com/saleor/saleor",children:"Saleor"}),", our GraphQL-first e-commerce software."]}),"\n",(0,t.jsx)(n.p,{children:"This means we are writing a lot of GraphQL clients, and a lot of those clients follow same structure:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["There's a module that evolves into a package named ",(0,t.jsx)(n.code,{children:"saleor_client"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["This client implements functions like ",(0,t.jsx)(n.code,{children:"get_shipping_methods"})," or ",(0,t.jsx)(n.code,{children:"create_checkout"})," that map 1:1 to GraphQL queries and mutations implemented by Saleor."]}),"\n",(0,t.jsx)(n.li,{children:"Each of those functions takes arguments it packages into a variables dictionary and combines them with Python string containing a GraphQL query."}),"\n",(0,t.jsxs)(n.li,{children:["Each of those functions then does a ",(0,t.jsx)(n.code,{children:"POST"})," request, handles errors and returns the result."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Basically, we wrote functions upon a functions upon a functions that looked like this:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'async def create_checkout(client, email: str,  lines: dict, address: Address):\n    address_json = address.json()\n\n    variables = {\n        "channel": "USD",\n        "email" email,\n        "lines": [\n            {"variantId": variant, "quantity": quantity}\n            for variant, quantity in lines.items()\n        ],\n        "shippingAddress": address,\n        "billingAddress": address,\n    }\n\n    query = """\n    mutation CheckoutCreate($input: CheckoutCreateInput!) {\n        checkoutCreate(input: $input) {\n            checkout {\n                id\n            }\n            errors {\n                field\n                message\n                code\n                variants\n                lines\n                addressType\n            }\n        }\n    }\n    """\n\n    result = await client.post(\n        GRAPHQL_URL,\n        json={\n            "query": query,\n            "operationName": "CheckoutCreate",\n            "variables": {"input": variables}\n        }\n    )\n\n    # Repackages HTTP errors from httpx into errors like\n    # `SaleorAuthenticationError`\n    raise_saleor_error(result)\n\n    data = await result.json()\n\n    if data.get("errors"):\n        # Repackage GraphQL errors\n        raise_graphql_error(data["errors"])\n\n    return data["checkoutCreate"]["checkout"]["id"]\n'})}),"\n",(0,t.jsx)(n.p,{children:"There's actually a very little variety in logic of those functions, and many of them are created by copying an already existing function and changing the variables and query string. For functions that return an objects, we would also maintain Pydantic models so we have result data packaged as types with code suggestions and MyPy checks instead of dicts and lists."}),"\n",(0,t.jsx)(n.h3,{id:"automatization",children:"Automatization"}),"\n",(0,t.jsx)(n.p,{children:"Very quickly we've started to experiment with different approaches to automating this away:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Code generator which is aware of the GraphQL schema and converted GraphQL operations into a Python package."}),"\n",(0,t.jsx)(n.li,{children:"An WSDL-like client for GraphQL which also is aware of the GraphQL schema but did it's logic on the fly."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"First approach had a downside of requiring package to be regenerated on every new or changed query, but it had three upsides that we liked:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["It didn't have extra logic executed on the runtime, making it ",(0,t.jsx)(n.strong,{children:"faster"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["It's behavior didn't change on the runtime, making it easy to ",(0,t.jsx)(n.strong,{children:"learn and debug"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Generated code played nicely with code suggestions in IDEs and Mypy without need for any extra work."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Ariadne Codegen has grown from a complete rewrite of the original code generator that was created and used internally by a member of the Saleor Integrations Team."}),"\n",(0,t.jsx)(n.h2,{id:"ariadne-codegen",children:"Ariadne Codegen"}),"\n",(0,t.jsx)(n.p,{children:"Ariadne Codegen can be installed with pip:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"$ pip install ariadne-codegen\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This will give you a new command, ",(0,t.jsx)(n.code,{children:"ariadne-codegen"}),", which consumes the ",(0,t.jsx)(n.code,{children:"ariadne-codegen"})," configuration from the ",(0,t.jsx)(n.code,{children:"pyproject.toml"})," file."]}),"\n",(0,t.jsx)(n.p,{children:"Minimum required configuration is just paths to where the schema and queries are:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'[ariadne-codegen]\nschema_path = "schema.graphql"\nqueries_path = "queries.graphql"\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Create ",(0,t.jsx)(n.code,{children:"schema.graphql"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",children:"type Query {\n  hello: String!\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Create ",(0,t.jsx)(n.code,{children:"queries.graphql"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",children:"query GetHello {\n  hello\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"Now run the codegen:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"$ ariadne-codegen\n"})}),"\n",(0,t.jsxs)(n.p,{children:["New directory ",(0,t.jsx)(n.code,{children:"graphql_client"})," will be created for you. Feel free to explore its contents. It's ",(0,t.jsx)(n.code,{children:"__init__.py"}),' file will reexport what can be considered "public API" of your new GraphQL client.']}),"\n",(0,t.jsxs)(n.p,{children:["You can now use the client in your project by importing the ",(0,t.jsx)(n.code,{children:"Client"})," class from the ",(0,t.jsx)(n.code,{children:"graphql_client"})," package:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from graphql_client import Client\n\n\nasync def do_smth_with_graphql_api():\n    with Client(base_url = "http://my-client.com") as client:\n        result = await client.get_hello()\n        # `result` will be an instance of Pydantic model representing the result of\n        # `GetHello` query!\n        print(result.hello)\n'})}),"\n",(0,t.jsx)(n.h2,{id:"available-options-and-features",children:"Available options and features"}),"\n",(0,t.jsx)(n.p,{children:"Ariadne Codegen already provides quite a few configuration and customization options:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"It can be setup to generate either async or sync GraphQL client."}),"\n",(0,t.jsx)(n.li,{children:"It can be told to use custom base HTTP client class instead of default one."}),"\n",(0,t.jsx)(n.li,{children:"It can include extra files in the final package."}),"\n",(0,t.jsxs)(n.li,{children:["Generated classes can be extended with extra behaviors using the ",(0,t.jsx)(n.code,{children:"@mixin(...)"})," directive."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["See the ",(0,t.jsx)(n.a,{href:"https://github.com/mirumee/ariadne-codegen#readme",children:"readme file"})," for all available options."]}),"\n",(0,t.jsx)(n.h2,{id:"known-limitations",children:"Known limitations"}),"\n",(0,t.jsx)(n.p,{children:"File uploads and GraphQL subscriptions are not supported."}),"\n",(0,t.jsx)(n.h2,{id:"moving-forward",children:"Moving forward"}),"\n",(0,t.jsxs)(n.p,{children:["You are welcome to share the love and give feedback for this library on ",(0,t.jsx)(n.a,{href:"https://github.com/mirumee/ariadne/discussions",children:"Ariadne forums"}),"!"]}),"\n",(0,t.jsxs)(n.p,{children:["If you've found a bug or have a PR, please use ",(0,t.jsx)(n.a,{href:"https://github.com/mirumee/ariadne-codegen/issues/",children:"Github issues"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["We've already started planning new features and improvements. Those are also public on ",(0,t.jsx)(n.a,{href:"https://github.com/mirumee/ariadne-codegen/issues/",children:"project's Github"}),"."]})]})}function h(e={}){let{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},32764:function(e,n,i){i.d(n,{A:()=>r});let r=i.p+"assets/images/ariadne-codegen-d1613d8daf90d33f2fca3e2250781aed.jpg"},84429:function(e,n,i){i.d(n,{R:()=>s,x:()=>o});var r=i(96540);let t={},a=r.createContext(t);function s(e){let n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),r.createElement(a.Provider,{value:n},e.children)}},10452:function(e){e.exports=JSON.parse('{"permalink":"/blog/2023/02/02/ariadne-codegen","source":"@site/blog/2023-02-02-ariadne-codegen.md","title":"Announcing Ariadne Codegen!","description":"Ariadne Codegen!","date":"2023-02-02T00:00:00.000Z","tags":[],"readingTime":4,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Announcing Ariadne Codegen!"},"unlisted":false,"prevItem":{"title":"Ariadne 0.18","permalink":"/blog/2023/02/21/ariadne-0-18"},"nextItem":{"title":"Ariadne 0.17.1","permalink":"/blog/2023/01/09/ariadne-0-17-1"}}')}}]);