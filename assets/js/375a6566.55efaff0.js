"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([["80433"],{26861:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>r,toc:()=>d,default:()=>p,metadata:()=>a,assets:()=>o,contentTitle:()=>t});var a=JSON.parse('{"id":"file-uploads","title":"File uploads","description":"Ariadne implements the GraphQL multipart request specification that describes how file uploads should be implemented by both API clients and servers.","source":"@site/server_versioned_docs/version-0.11.0/file-uploads.md","sourceDirName":".","slug":"/file-uploads","permalink":"/server/0.11.0/file-uploads","draft":false,"unlisted":false,"tags":[],"version":"0.11.0","frontMatter":{"id":"file-uploads","title":"File uploads"},"sidebar":"tutorialSidebar","previous":{"title":"Subscriptions","permalink":"/server/0.11.0/subscriptions"},"next":{"title":"Documenting schema","permalink":"/server/0.11.0/documenting-schema"}}'),i=s(74848),l=s(84429);let r={id:"file-uploads",title:"File uploads"},t,o={},d=[{value:"Enabling file uploads",id:"enabling-file-uploads",level:2},{value:"Limitations",id:"limitations",level:2},{value:"Implementation differences",id:"implementation-differences",level:2},{value:"<code>ariadne.asgi</code>",id:"ariadneasgi",level:3},{value:"<code>ariadne.wsgi</code>",id:"ariadnewsgi",level:3},{value:"<code>ariadne.contrib.django</code>",id:"ariadnecontribdjango",level:3}];function c(e){let n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["Ariadne implements the ",(0,i.jsx)(n.a,{href:"https://github.com/jaydenseric/graphql-multipart-request-spec",children:"GraphQL multipart request specification"})," that describes how file uploads should be implemented by both API clients and servers."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Note"})}),"\n",(0,i.jsxs)(n.p,{children:["File uploads support for ASGI server requires that ",(0,i.jsx)(n.code,{children:"python-multipart"})," is installed:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-console",children:"pip install ariadne[asgi-file-uploads]\n"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"enabling-file-uploads",children:"Enabling file uploads"}),"\n",(0,i.jsxs)(n.p,{children:["To enable file uploads on your server, define new a scalar named ",(0,i.jsx)(n.code,{children:"Upload"})," in your schema:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"scalar Upload\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Next, import ",(0,i.jsx)(n.code,{children:"upload_scalar"})," from ",(0,i.jsx)(n.code,{children:"ariadne"})," package and use it during the creation of your executable schema:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from ariadne import make_executable_schema, upload_scalar\n\n# ...your types definitions\n\nschema = make_executable_schema(type_defs, [..., upload_scalar])\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You will now be able to use ",(0,i.jsx)(n.code,{children:"Upload"})," scalar arguments for your operations:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"type Mutation {\n    uploadUserImage(image: Upload!): Boolean!\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"limitations",children:"Limitations"}),"\n",(0,i.jsxs)(n.p,{children:["The default ",(0,i.jsx)(n.code,{children:"Upload"})," scalar is a write-only scalar that supports only accessing the value that was passed through the ",(0,i.jsx)(n.code,{children:"variables"}),". It is not possible to use it as return value for a GraphQL field or set its value in a GraphQL Query:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'type User {\n    "This field will fail with ValueError"\n    image: Upload\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'mutation {\n    uploadUserImage(image: "data:text/plain;base64,QXJpYWRuZSByb2NrcyE=")\n}\n'})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["You are not required to use the ",(0,i.jsx)(n.code,{children:"Upload"})," scalar implementation provided by Ariadne. You can implement your own if you wish to, so you can (for example) support file literals as base64 data."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"implementation-differences",children:"Implementation differences"}),"\n",(0,i.jsxs)(n.p,{children:["The Python value returned by the ",(0,i.jsx)(n.code,{children:"Upload"})," scalar is not standardized and depends on your technology stack:"]}),"\n",(0,i.jsx)(n.h3,{id:"ariadneasgi",children:(0,i.jsx)(n.code,{children:"ariadne.asgi"})}),"\n",(0,i.jsxs)(n.p,{children:["Ariadne's ASGI support is based on ",(0,i.jsx)(n.a,{href:"https://starlette.io",children:"Starlette"})," and hence uploaded files are instances of ",(0,i.jsx)(n.a,{href:"https://www.starlette.io/requests/#request-files",children:(0,i.jsx)(n.code,{children:"UploadFile"})}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"ariadnewsgi",children:(0,i.jsx)(n.code,{children:"ariadne.wsgi"})}),"\n",(0,i.jsxs)(n.p,{children:["Ariadne's WSGI support uses the ",(0,i.jsx)(n.code,{children:"cgi"})," module from Python's standard library that represents uploaded files as instances of ",(0,i.jsx)(n.a,{href:"https://docs.python.org/3/library/cgi.html#using-the-cgi-module",children:(0,i.jsx)(n.code,{children:"FieldStorage"})}),"."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Data in ",(0,i.jsx)(n.code,{children:"FieldStorage"})," is not guaranteed to represent an uploaded file."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"ariadnecontribdjango",children:(0,i.jsx)(n.code,{children:"ariadne.contrib.django"})}),"\n",(0,i.jsxs)(n.p,{children:["Ariadne's Django integration uses ",(0,i.jsx)(n.code,{children:"request.FILES"})," to obtain uploaded files. Depending on file uploads configuration in your Django project, the files are instances of ",(0,i.jsx)(n.a,{href:"https://docs.djangoproject.com/en/2.2/ref/files/uploads/",children:(0,i.jsx)(n.code,{children:"UploadedFile"})})," or one of its subclasses."]})]})}function p(e={}){let{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},84429:function(e,n,s){s.d(n,{R:()=>r,x:()=>t});var a=s(96540);let i={},l=a.createContext(i);function r(e){let n=a.useContext(l);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(l.Provider,{value:n},e.children)}}}]);