<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Middleware · Ariadne</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;GraphQL middleware are Python functions and callable objects that can be used to inject custom logic into query executor.&lt;/p&gt;
"/><meta name="docsearch:version" content="0.21"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Middleware · Ariadne"/><meta property="og:type" content="website"/><meta property="og:url" content="https://ariadnegraphql.org/"/><meta property="og:description" content="&lt;p&gt;GraphQL middleware are Python functions and callable objects that can be used to inject custom logic into query executor.&lt;/p&gt;
"/><meta property="og:image" content="https://ariadnegraphql.org/img/share-image.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://ariadnegraphql.org/img/twitter-image.png"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"/><link rel="alternate" type="application/atom+xml" href="https://ariadnegraphql.org/blog/atom.xml" title="Ariadne Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://ariadnegraphql.org/blog/feed.xml" title="Ariadne Blog RSS Feed"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-10159761-23', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><link rel="stylesheet" href="/css/prism.css"/><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo-horizontal.png" alt="Ariadne"/></a><a href="/versions"><h3>0.21</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><li class="siteNavGroupActive"><a href="/docs/intro" target="_self">Docs</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class=""><a href="/community" target="_self">Community</a></li><li class=""><a href="https://github.com/mirumee/ariadne" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Extensions</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Docs</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/intro">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/resolvers">Resolvers</a></li><li class="navListItem"><a class="navItem" href="/docs/mutations">Mutations</a></li><li class="navListItem"><a class="navItem" href="/docs/inputs">Inputs</a></li><li class="navListItem"><a class="navItem" href="/docs/error-messaging">Error messaging</a></li><li class="navListItem"><a class="navItem" href="/docs/case-conversion">Name case conversion</a></li><li class="navListItem"><a class="navItem" href="/docs/scalars">Custom scalars</a></li><li class="navListItem"><a class="navItem" href="/docs/enums">Enumeration types</a></li><li class="navListItem"><a class="navItem" href="/docs/unions">Union types</a></li><li class="navListItem"><a class="navItem" href="/docs/interfaces">Interface types</a></li><li class="navListItem"><a class="navItem" href="/docs/subscriptions">Subscriptions</a></li><li class="navListItem"><a class="navItem" href="/docs/dataloaders">Dataloaders</a></li><li class="navListItem"><a class="navItem" href="/docs/file-uploads">File uploads</a></li><li class="navListItem"><a class="navItem" href="/docs/documenting-schema">Documenting schema</a></li><li class="navListItem"><a class="navItem" href="/docs/modularization">Modularization</a></li><li class="navListItem"><a class="navItem" href="/docs/bindables">Bindables</a></li><li class="navListItem"><a class="navItem" href="/docs/schema-directives">Schema directives</a></li><li class="navListItem"><a class="navItem" href="/docs/local-development">Local development</a></li><li class="navListItem"><a class="navItem" href="/docs/logging">Logging</a></li><li class="navListItem"><a class="navItem" href="/docs/explorers">GraphQL explorers</a></li><li class="navListItem"><a class="navItem" href="/docs/apollo-federation">Apollo Federation</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Monitoring</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/open-telemetry">OpenTelemetry</a></li><li class="navListItem"><a class="navItem" href="/docs/open-tracing">OpenTracing</a></li><li class="navListItem"><a class="navItem" href="/docs/apollo-tracing">Apollo Tracing</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Security</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/security-overview">Security Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/hiding-field-suggestions">Hiding field suggestions</a></li><li class="navListItem"><a class="navItem" href="/docs/disabling-stack-traces">Disabling stack traces</a></li><li class="navListItem"><a class="navItem" href="/docs/continuous-security-testing">Continuous security testing</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Servers</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/asgi">ASGI application</a></li><li class="navListItem"><a class="navItem" href="/docs/wsgi">WSGI application</a></li><li class="navListItem"><a class="navItem" href="/docs/aws-lambda">AWS lambda</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Integrations</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/django-integration">Django</a></li><li class="navListItem"><a class="navItem" href="/docs/fastapi-integration">FastAPI</a></li><li class="navListItem"><a class="navItem" href="/docs/flask-integration">Flask</a></li><li class="navListItem"><a class="navItem" href="/docs/starlette-integration">Starlette</a></li><li class="navListItem"><a class="navItem" href="/docs/other-integrations">Other technologies</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Extensions</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/extensions">Extension system</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/middleware">Middleware</a></li><li class="navListItem"><a class="navItem" href="/docs/query-validators">Query validators</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">API reference</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/api-reference">ariadne</a></li><li class="navListItem"><a class="navItem" href="/docs/asgi-reference">ariadne.asgi</a></li><li class="navListItem"><a class="navItem" href="/docs/asgi-handlers-reference">ariadne.asgi.handlers</a></li><li class="navListItem"><a class="navItem" href="/docs/constants-reference">ariadne.constants</a></li><li class="navListItem"><a class="navItem" href="/docs/exceptions-reference">ariadne.exceptions</a></li><li class="navListItem"><a class="navItem" href="/docs/types-reference">ariadne.types</a></li><li class="navListItem"><a class="navItem" href="/docs/wsgi-reference">ariadne.wsgi</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Other</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/logo">Ariadne logo</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Middleware</h1></header><article><div><span><p>GraphQL middleware are Python functions and callable objects that can be used to inject custom logic into query executor.</p>
<p>Middlewares share most of their arguments with <a href="/docs/types-reference#resolver"><code>resolvers</code></a>, but take one extra argument: <code>resolver</code> callable that is resolver associated with currently resolved field:</p>
<pre><code class="hljs css language-python">def lowercase_middleware(resolver, obj, info, **args)
</code></pre>
<blockquote>
<p><strong>Note</strong></p>
<p>GraphQL middleware is sometimes confused with the ASGI or WSGI middleware, but its not the same thing!</p>
</blockquote>
<blockquote>
<p><strong>Note</strong></p>
<p>Middleware is not supported by subscriptions.</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="custom-middleware-example"></a><a href="#custom-middleware-example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Custom middleware example</h2>
<p>Code below implements custom middleware that converts any strings returned by resolvers to lower case:</p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> inspect <span class="hljs-keyword">import</span> iscoroutinefunction

<span class="hljs-keyword">from</span> graphql.pyutils <span class="hljs-keyword">import</span> is_awaitable


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">lowercase_middleware</span><span class="hljs-params">(resolver, obj, info, **args)</span>:</span>
    <span class="hljs-keyword">if</span> iscoroutinefunction(resolver):
        <span class="hljs-keyword">return</span> lowercase_middleware_async(resolver, obj, info, **args)

    value = resolver(obj, info, **args)
    <span class="hljs-keyword">if</span> is_awaitable(value):
        <span class="hljs-keyword">return</span> lowercase_awaitable(value)

    <span class="hljs-keyword">return</span> lowercase_value(<span class="hljs-keyword">await</span> value)


<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">lowercase_middleware_async</span><span class="hljs-params">(resolver, obj, info, **args)</span>:</span>
    value = <span class="hljs-keyword">await</span> resolver(obj, info, **args)
    <span class="hljs-keyword">if</span> is_awaitable(value):
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> lowercase_awaitable(value)

    <span class="hljs-keyword">return</span> lowercase_value(<span class="hljs-keyword">await</span> value)


<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">lowercase_awaitable</span><span class="hljs-params">(value)</span>:</span>
    <span class="hljs-keyword">return</span> lowercase_value(<span class="hljs-keyword">await</span> value)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">lowercase_value</span><span class="hljs-params">(value)</span>:</span>
    <span class="hljs-keyword">if</span> isinstance(value, str):
        <span class="hljs-keyword">return</span> value.lower()

    <span class="hljs-keyword">return</span> value
</code></pre>
<blockquote>
<p><strong>Note:</strong> Please see the <a href="#asynchronous-middleware">asynchronous middleware</a> section for an explanation for this implementation.</p>
</blockquote>
<p>To use <code>lowercase_middleware</code> middleware in your queries, pass it to the <code>middleware</code> option of the HTTP handler:</p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> ariadne.asgi <span class="hljs-keyword">import</span> GraphQL
<span class="hljs-keyword">from</span> ariadne.asgi.handlers <span class="hljs-keyword">import</span> GraphQLHTTPHandler


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">lowercase_middleware</span><span class="hljs-params">(resolver, obj, info, **args)</span>:</span>
    value = resolver(obj, info, **args)
    <span class="hljs-keyword">if</span> isinstance(value, str):
        <span class="hljs-keyword">return</span> value.lower()
    <span class="hljs-keyword">return</span> value


app = GrapqhQL(
    schema,
    http_handler=GraphQLHTTPHandler(
        middleware=[lowercase_middleware],
    ),
)
</code></pre>
<p>In case when more than one middleware is enabled on the server, the <code>resolver</code> argument will point to the partial function constructed from the next middleware in the execution chain.</p>
<h2><a class="anchor" aria-hidden="true" id="middleware-managers"></a><a href="#middleware-managers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Middleware managers</h2>
<p>Middleware are ran through special class implemented by GraphQL named <code>MiddlewareManager</code>. If you want to replace this manager with custom one, you provide your own implementation using the <code>middleware_manager_class</code> option:</p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> ariadne.asgi <span class="hljs-keyword">import</span> GraphQL
<span class="hljs-keyword">from</span> ariadne.asgi.handlers <span class="hljs-keyword">import</span> GraphQLHTTPHandler
<span class="hljs-keyword">from</span> graphql <span class="hljs-keyword">import</span> GraphQLFieldResolver, MiddlewareManager


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">lowercase_middleware</span><span class="hljs-params">(resolver, obj, info, **args)</span>:</span>
    value = resolver(obj, info, **args)
    <span class="hljs-keyword">if</span> isinstance(value, str):
        <span class="hljs-keyword">return</span> value.lower()
    <span class="hljs-keyword">return</span> value


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomMiddlewareManager</span><span class="hljs-params">(MiddlewareManager)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_field_resolver</span><span class="hljs-params">(
        self, field_resolver: GraphQLFieldResolver
    )</span> -&gt; GraphQLFieldResolver:</span>
        <span class="hljs-string">"""Wrap the provided resolver with the middleware.
        Returns a function that chains the middleware functions with the provided
        resolver function.
        """</span>
        <span class="hljs-keyword">if</span> self._middleware_resolvers <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> field_resolver
        <span class="hljs-keyword">if</span> field_resolver <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self._cached_resolvers:
            self._cached_resolvers[field_resolver] = reduce(
                <span class="hljs-keyword">lambda</span> chained_fns, next_fn: partial(next_fn, chained_fns),
                self._middleware_resolvers,
                field_resolver,
            )
        <span class="hljs-keyword">return</span> self._cached_resolvers[field_resolver]


app = GrapqhQL(
    schema,
    http_handler=GraphQLHTTPHandler(
        middleware=[lowercase_middleware],
        middleware_manager_class=CustomMiddlewareManager,
    ),
)
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="middleware-and-extensions"></a><a href="#middleware-and-extensions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Middleware and extensions</h2>
<p>Extensions <a href="/docs/types-reference#resolve"><code>resolve</code></a> hook is actually a middleware. In case when GraphQL server is configured to use both middleware and extensions, extensions <code>resolve</code> hooks will be executed before the <code>middleware</code> functions.</p>
<h2><a class="anchor" aria-hidden="true" id="performance-impact"></a><a href="#performance-impact" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Performance impact</h2>
<p>Middlewares are called for <strong>EVERY</strong> resolver call.</p>
<p>Considering this query:</p>
<pre><code class="hljs css language-graphql"><span class="token punctuation">{</span>
    users <span class="token punctuation">{</span>
        id
        email
        username
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>If <code>users</code> resolver returns 100 users, middleware function will be called 301 times:</p>
<ul>
<li>one time for <code>Query.users</code> resolver</li>
<li>100 times for <code>id</code></li>
<li>100 times for <code>email</code></li>
<li>100 times for username</li>
</ul>
<p>Avoid implementing costful or slow logic in middlewares. Use python decorators applied explicitly to resolver functions or ASGI/WSGI middlewares combined with callable <code>context_value</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="asynchronous-middleware"></a><a href="#asynchronous-middleware" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Asynchronous middleware</h3>
<p>In the <a href="#custom-middleware-example">custom middleware example</a> above single synchronous middleware was implemented that supported following cases:</p>
<ul>
<li>Asynchronous resolver returning a value.</li>
<li>Asynchronous resolver returning awaitable a value.</li>
<li>Synchronous resolver returning a value.</li>
<li>Synchronous resolver returning awaitable a value.</li>
</ul>
<p>Converting this middleware to async would greatly simplify the implementation:</p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> graphql.pyutils <span class="hljs-keyword">import</span> is_awaitable


<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">lowercase_middleware</span><span class="hljs-params">(resolver, obj, info, **args)</span>:</span>
    <span class="hljs-keyword">if</span> iscoroutinefunction(resolver):
        value = <span class="hljs-keyword">await</span> resolver(obj, info, **args)
    <span class="hljs-keyword">else</span>:
        value = resolver(obj, info, **args)

    <span class="hljs-keyword">if</span> is_awaitable(value):
        value = <span class="hljs-keyword">await</span> value

    <span class="hljs-keyword">if</span> isinstance(value, str):
        <span class="hljs-keyword">return</span> value.lower()

    <span class="hljs-keyword">return</span> value
</code></pre>
<p>However, asynchronous middleware require for their result being <code>awaited</code> during query execution. Asynchronous functions in Python are considered fast, but the overhead of being sent to the event loop and having their result retrieved makes them <strong>much</strong> slower than plain synchronous function call for scenarios where no IO is involved. Because default implementation of middleware manager calls middlewares for every field in result set, this effectively turns all resolver calls in query executor into asynchronous calls. This makes query execution noticeably slower even for small GraphQL queries, and quick benchmarks have found that it can slow queries by x1.5 to x2.5.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/extensions"><span class="arrow-prev">← </span><span>Extension system</span></a><a class="docs-next button" href="/docs/query-validators"><span>Query validators</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#custom-middleware-example">Custom middleware example</a></li><li><a href="#middleware-managers">Middleware managers</a></li><li><a href="#middleware-and-extensions">Middleware and extensions</a></li><li><a href="#performance-impact">Performance impact</a><ul class="toc-headings"><li><a href="#asynchronous-middleware">Asynchronous middleware</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/icon.png" alt="Ariadne" height="107" width="128"/></a><div class="footerNavSpacer"></div><div class="footerNavTwoColumn"><h5>Documentation</h5><a href="/docs/intro.html">Introduction</a><a href="/docs/resolvers.html">Resolvers</a><a href="/docs/mutations.html">Mutations</a><a href="/docs/subscriptions.html">Subscriptions</a><a href="/docs/django-integration.html">Django integration</a><a href="/docs/flask-integration.html">Flask integration</a><a href="/docs/starlette-integration.html">Starlette integration</a><a href="/docs/other-integrations.html">Other integrations</a><a href="/docs/api-reference.html">API Reference</a><a href="/docs/logo.html">Logo</a></div><div><h5>Community</h5><a href="https://github.com/mirumee/ariadne/discussions/">Discuss</a><a href="https://github.com/mirumee/ariadne">GitHub</a><a class="github-button" href="https://github.com/mirumee/ariadne" data-icon="octicon-star" data-count-href="/mirumee/ariadne/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright"><a href="https://mirumee.com">Copyright © 2023 Mirumee Software</a><a href="https://mirumee.com">Ariadne is crafted with love by<img src="/img/mirumee.png" alt="Mirumee"/></a></section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '507581234da84aebc8fe9918f530b714',
                indexName: 'ariadnegraphql',
                inputSelector: '#search_input_react'
              });
            </script></body></html>