<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Query validators · Ariadne</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;GraphQL uses query validators to check if Query AST is valid and can be executed. Every GraphQL server implements standard query validators. For example, there is an validator that tests if queried field exists on queried type, that makes query fail with &amp;quot;Cannot query field on type&amp;quot; error if it doesn&#x27;t.&lt;/p&gt;
"/><meta name="docsearch:version" content="0.19"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Query validators · Ariadne"/><meta property="og:type" content="website"/><meta property="og:url" content="https://ariadnegraphql.org/"/><meta property="og:description" content="&lt;p&gt;GraphQL uses query validators to check if Query AST is valid and can be executed. Every GraphQL server implements standard query validators. For example, there is an validator that tests if queried field exists on queried type, that makes query fail with &amp;quot;Cannot query field on type&amp;quot; error if it doesn&#x27;t.&lt;/p&gt;
"/><meta property="og:image" content="https://ariadnegraphql.org/img/share-image.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://ariadnegraphql.org/img/twitter-image.png"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"/><link rel="alternate" type="application/atom+xml" href="https://ariadnegraphql.org/blog/atom.xml" title="Ariadne Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://ariadnegraphql.org/blog/feed.xml" title="Ariadne Blog RSS Feed"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-10159761-23', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><link rel="stylesheet" href="/css/prism.css"/><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo-horizontal.png" alt="Ariadne"/></a><a href="/versions"><h3>0.19</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><li class="siteNavGroupActive"><a href="/docs/0.19/intro" target="_self">Docs</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class=""><a href="/community" target="_self">Community</a></li><li class=""><a href="https://github.com/mirumee/ariadne" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Extensions</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Docs</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/0.19/intro">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/resolvers">Resolvers</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/mutations">Mutations</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/inputs">Inputs</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/error-messaging">Error messaging</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/case-conversion">Name case conversion</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/scalars">Custom scalars</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/enums">Enumeration types</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/unions">Union types</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/interfaces">Interface types</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/subscriptions">Subscriptions</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/dataloaders">Dataloaders</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/file-uploads">File uploads</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/documenting-schema">Documenting schema</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/modularization">Modularization</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/bindables">Bindables</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/schema-directives">Schema directives</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/local-development">Local development</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/logging">Logging</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/explorers">GraphQL explorers</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/apollo-federation">Apollo Federation</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Monitoring</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/0.19/apollo-tracing">Apollo Tracing</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/open-tracing">OpenTracing</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Security</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/0.19/security-overview">Security Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/hiding-field-suggestions">Hiding field suggestions</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/disabling-stack-traces">Disabling stack traces</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/continuous-security-testing">Continuous security testing</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Servers</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/0.19/asgi">ASGI application</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/wsgi">WSGI application</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/aws-lambda">AWS lambda</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Integrations</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/0.19/django-integration">Django</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/fastapi-integration">FastAPI</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/flask-integration">Flask</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/starlette-integration">Starlette</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/other-integrations">Other technologies</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Extensions</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/0.19/extensions">Extension system</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/middleware">Middleware</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/0.19/query-validators">Query validators</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">API reference</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/0.19/api-reference">ariadne</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/asgi-reference">ariadne.asgi</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/asgi-handlers-reference">ariadne.asgi.handlers</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/constants-reference">ariadne.constants</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/exceptions-reference">ariadne.exceptions</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/types-reference">ariadne.types</a></li><li class="navListItem"><a class="navItem" href="/docs/0.19/wsgi-reference">ariadne.wsgi</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Other</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/0.19/logo">Ariadne logo</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Query validators</h1></header><article><div><span><p>GraphQL uses query validators to check if Query AST is valid and can be executed. Every GraphQL server implements standard query validators. For example, there is an validator that tests if queried field exists on queried type, that makes query fail with &quot;Cannot query field on type&quot; error if it doesn't.</p>
<p>Ariadne supports extending this server behaviour by including custom query validators.</p>
<h2><a class="anchor" aria-hidden="true" id="query-cost-validator"></a><a href="#query-cost-validator" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Query cost validator</h2>
<p>Query cost validation allows server owners to limit maximal allowed cost (or complexity) of GraphQL query. This forces malicious clients to run multiple HTTP requests which in turn allows server owners to limit or filter off their traffic through HTTP server settings.</p>
<p>First, query cost validator needs to be enabled on GraphQL server using <code>validation_rules</code> option:</p>
<pre><code class="hljs"><span class="hljs-keyword">from</span> ariadne.asgi import GraphQL
<span class="hljs-keyword">from</span> ariadne.validation import cost_validator

schema = make_executable_schema() # make_executable_schema call with<span class="hljs-built_in"> type </span>definitions, resolvers, etc. ect.

graphql = Graphql(
    schema,
    validation_rules=[cost_validator(<span class="hljs-attribute">maximum_cost</span>=5)]
)
</code></pre>
<p>Next step is assigning costs values to schema fields. This can be done in Python or in the schema.</p>
<h3><a class="anchor" aria-hidden="true" id="setting-fields-costs-in-schema"></a><a href="#setting-fields-costs-in-schema" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setting fields costs in schema</h3>
<p>To set fields costs in schema, first add <code>cost</code> directive definition to it:</p>
<pre><code class="hljs css language-graphql">directive <span class="token directive function">@cost</span><span class="token punctuation">(</span><span class="token attr-name">complexity</span><span class="token punctuation">:</span> Int<span class="token punctuation">,</span> <span class="token attr-name">multipliers</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>String<span class="token operator">!</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token attr-name">useMultipliers</span><span class="token punctuation">:</span> Boolean<span class="token punctuation">)</span> <span class="token keyword">on</span> <span class="token class-name">FIELD</span> <span class="token operator">|</span> <span class="token constant">FIELD_DEFINITION</span>
</code></pre>
<p>To make your schema future proof, directive's definition is available as import from Ariadne:</p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> ariadne.validation <span class="hljs-keyword">import</span> cost_directive

schema = make_executable_schema([type_defs, cost_directive], ...)
</code></pre>
<p>Now you can use this directive to assign costs to selected fields. For example, you can set cost of accessing <code>poster</code> field on <code>Post</code> type as <code>3</code> like this:</p>
<pre><code class="hljs css language-graphql"><span class="token keyword">type</span> <span class="token class-name">Post</span> <span class="token punctuation">{</span>
    <span class="token attr-name">id</span><span class="token punctuation">:</span> ID
    <span class="token attr-name">name</span><span class="token punctuation">:</span> String
    <span class="token attr-name">poster</span><span class="token punctuation">:</span> User <span class="token directive function">@cost</span><span class="token punctuation">(</span><span class="token attr-name">complexity</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>If you want to, you can make cost depend on the value of one or more of <code>Int</code> arguments that field accepts:</p>
<pre><code class="hljs css language-graphql"><span class="token keyword">type</span> <span class="token class-name">Query</span> <span class="token punctuation">{</span>
    <span class="token attr-name">news</span><span class="token punctuation">(</span><span class="token attr-name">promoted</span><span class="token punctuation">:</span> Int<span class="token punctuation">,</span> <span class="token attr-name">regular</span><span class="token punctuation">:</span> Int<span class="token punctuation">)</span><span class="token punctuation">:</span> Post <span class="token directive function">@cost</span><span class="token punctuation">(</span><span class="token attr-name">complexity</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token attr-name">multipliers</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"promoted"</span><span class="token punctuation">,</span> <span class="token string">"regular"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>In the above example, final complexity will be multiplied by both <code>promoted</code> and <code>regular</code> values.</p>
<p>You can also use <code>useMultipliers</code> to remove query cost multiplication for specified field without removing <code>@cost</code> from it:</p>
<pre><code class="hljs css language-graphql"><span class="token keyword">type</span> <span class="token class-name">Query</span> <span class="token punctuation">{</span>
    <span class="token attr-name">news</span><span class="token punctuation">(</span><span class="token attr-name">promoted</span><span class="token punctuation">:</span> Int<span class="token punctuation">)</span><span class="token punctuation">:</span> Post <span class="token directive function">@cost</span><span class="token punctuation">(</span><span class="token attr-name">complexity</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token attr-name">multipliers</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"promoted"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token attr-name">useMultipliers</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="setting-fields-costs-in-python"></a><a href="#setting-fields-costs-in-python" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setting fields costs in Python</h3>
<p>Fields costs can be set using Python dict passed as an option to <code>cost_validator</code>:</p>
<pre><code class="hljs css language-python">cost_map = {
    <span class="hljs-string">"Query"</span>: {
        <span class="hljs-string">"news"</span>: {<span class="hljs-string">"complexity"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"multipliers"</span>: [<span class="hljs-string">"promoted"</span>, <span class="hljs-string">"regular"</span>]},
    },
    <span class="hljs-string">"Post"</span>: {
        <span class="hljs-string">"poster"</span>: {<span class="hljs-string">"complexity"</span>: <span class="hljs-number">3</span>},
    },
}

graphql = Graphql(
    type_defs,
    validation_rules=[cost_validator(maximum_cost=<span class="hljs-number">5</span>, cost_map=cost_map)]
)
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="setting-default-field-cost-and-complexity"></a><a href="#setting-default-field-cost-and-complexity" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setting default field cost and complexity</h3>
<p><code>cost_validator</code> supports two additional options to make configuring costs less verbose:</p>
<ul>
<li><code>default_complexity: int</code> - Default value for field <code>complexity</code> if its omitted from <code>@cost</code> or <code>price_map</code>. Defaults to <code>1</code>.</li>
<li><code>default_cost: int</code> - Default base value for field cost. Defaults to <code>0</code>.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="configuring-cost_validator-dynamically"></a><a href="#configuring-cost_validator-dynamically" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuring <code>cost_validator</code> dynamically</h3>
<p>Because <code>validation_rules</code> option can be a <code>callable</code> (eg. function), it can be used to dynamically configure query costs validation based on GraphQL context or even parsed query itself:</p>
<pre><code class="hljs css language-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_validation_rules</span><span class="hljs-params">(context_value, document, data)</span>:</span>
    user = context_value.get(<span class="hljs-string">"user"</span>)
    <span class="hljs-keyword">if</span> user:
        <span class="hljs-keyword">if</span> user.is_admin:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
        <span class="hljs-keyword">if</span> user.is_high_ltv:
            <span class="hljs-keyword">return</span> [cost_validator(maximum_cost=<span class="hljs-number">15</span>)]
    
    <span class="hljs-keyword">return</span> [cost_validator(maximum_cost=<span class="hljs-number">5</span>)]


graphql = Graphql(
    schema,
    validation_rules=get_validation_rules
)
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="exposing-query-variables-to-cost_validator"></a><a href="#exposing-query-variables-to-cost_validator" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Exposing query variables to <code>cost_validator</code></h3>
<p>Cost validator will raise an error if query containing variables is made, but variable values are not made available to the validator. Use dynamic configuration to avoid this:</p>
<pre><code class="hljs css language-python">type_defs = gql(
    <span class="hljs-string">"""
    type Query {
        hello(id: Int!): String!
    }
    """</span>
)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_validation_rules</span><span class="hljs-params">(context_value, document, data)</span>:</span>
    <span class="hljs-keyword">return</span> [cost_validator(maximum_cost=<span class="hljs-number">5</span>, variables=data.get(<span class="hljs-string">"variables"</span>))]


schema = make_executable_schema(type_defs)

graphql = Graphql(
    schema,
    validation_rules=get_validation_rules,
)
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="complexity-of-lists-of-items"></a><a href="#complexity-of-lists-of-items" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Complexity of lists of items</h3>
<p>Query cost validation runs before query execution. This makes it impossible for field cost to depend on real number of returned children.</p>
<p>To deal with that you should use either multipliers, dynamic query cost configuration or make field's cost high enough in advance.</p>
<h2><a class="anchor" aria-hidden="true" id="implementing-custom-validator"></a><a href="#implementing-custom-validator" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Implementing custom validator</h2>
<p>All custom query validators should extend the <a href="https://github.com/graphql-python/graphql-core/blob/v3.0.5/src/graphql/validation/rules/__init__.py#L37"><code>ValidationRule</code></a> base class importable from the <code>graphql.validation.rules</code> module.</p>
<p>Query validators are visitor classes. They are instantiated at the time of query validation with one required argument (<code>context: ASTValidationContext</code>).</p>
<p>In order to perform validation, your validator class should define one or more of <code>enter_*</code> and <code>leave_*</code> methods. For possible enter/leave items as well as details on function documentation, please see contents of the <a href="https://github.com/graphql-python/graphql-core/blob/v3.0.5/src/graphql/language/visitor.py"><code>visitor</code></a> module.</p>
<p>To make validation fail, you should call validator's <code>report_error</code> method with the instance of <code>GraphQLError</code> describing failure reason.</p>
<p>Here is an example query validator that visits field definitions in GraphQL query and fails query validation if any of those fields are introspection fields:</p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> graphql <span class="hljs-keyword">import</span> GraphQLError
<span class="hljs-keyword">from</span> graphql.language <span class="hljs-keyword">import</span> FieldNode
<span class="hljs-keyword">from</span> graphql.validation <span class="hljs-keyword">import</span> ValidationRule


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_introspection_field</span><span class="hljs-params">(field_name: str)</span>:</span>
    <span class="hljs-keyword">return</span> field_name.lower() <span class="hljs-keyword">in</span> [
        <span class="hljs-string">"__schema"</span>,
        <span class="hljs-string">"__directive"</span>,
        <span class="hljs-string">"__directivelocation"</span>,
        <span class="hljs-string">"__type"</span>,
        <span class="hljs-string">"__field"</span>,
        <span class="hljs-string">"__inputvalue"</span>,
        <span class="hljs-string">"__enumvalue"</span>,
        <span class="hljs-string">"__typekind"</span>,
    ]


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IntrospectionDisabledRule</span><span class="hljs-params">(ValidationRule)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">enter_field</span><span class="hljs-params">(self, node: FieldNode, *_args)</span>:</span>
        field_name = node.name.value
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> is_introspection_key(field_name):
            <span class="hljs-keyword">return</span>

        self.report_error(
            GraphQLError(
                <span class="hljs-string">f"Cannot query '<span class="hljs-subst">{field_name}</span>': introspection is disabled."</span>, node,
            )
        )

</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/0.19/middleware"><span class="arrow-prev">← </span><span>Middleware</span></a><a class="docs-next button" href="/docs/0.19/api-reference"><span>ariadne</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#query-cost-validator">Query cost validator</a><ul class="toc-headings"><li><a href="#setting-fields-costs-in-schema">Setting fields costs in schema</a></li><li><a href="#setting-fields-costs-in-python">Setting fields costs in Python</a></li><li><a href="#setting-default-field-cost-and-complexity">Setting default field cost and complexity</a></li><li><a href="#configuring-cost_validator-dynamically">Configuring <code>cost_validator</code> dynamically</a></li><li><a href="#exposing-query-variables-to-cost_validator">Exposing query variables to <code>cost_validator</code></a></li><li><a href="#complexity-of-lists-of-items">Complexity of lists of items</a></li></ul></li><li><a href="#implementing-custom-validator">Implementing custom validator</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/icon.png" alt="Ariadne" height="107" width="128"/></a><div class="footerNavSpacer"></div><div class="footerNavTwoColumn"><h5>Documentation</h5><a href="/docs/intro.html">Introduction</a><a href="/docs/resolvers.html">Resolvers</a><a href="/docs/mutations.html">Mutations</a><a href="/docs/subscriptions.html">Subscriptions</a><a href="/docs/django-integration.html">Django integration</a><a href="/docs/flask-integration.html">Flask integration</a><a href="/docs/starlette-integration.html">Starlette integration</a><a href="/docs/other-integrations.html">Other integrations</a><a href="/docs/api-reference.html">API Reference</a><a href="/docs/logo.html">Logo</a></div><div><h5>Community</h5><a href="https://github.com/mirumee/ariadne/discussions/">Discuss</a><a href="https://github.com/mirumee/ariadne">GitHub</a><a class="github-button" href="https://github.com/mirumee/ariadne" data-icon="octicon-star" data-count-href="/mirumee/ariadne/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright"><a href="https://mirumee.com">Copyright © 2024 Mirumee Software</a><a href="https://mirumee.com">Ariadne is crafted with love by<img src="/img/mirumee.png" alt="Mirumee"/></a></section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '507581234da84aebc8fe9918f530b714',
                indexName: 'ariadnegraphql',
                inputSelector: '#search_input_react'
              });
            </script></body></html>