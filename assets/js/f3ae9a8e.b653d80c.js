"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([["75900"],{70615:function(e,r,n){n.r(r),n.d(r,{frontMatter:()=>i,toc:()=>d,default:()=>u,metadata:()=>t,assets:()=>l,contentTitle:()=>a});var t=JSON.parse('{"id":"error-messaging","title":"Error messaging","description":"If you\'ve experimented with GraphQL, you should be familiar that when things don\'t go according to plan, GraphQL servers include an additional key errors in the returned response:","source":"@site/server_versioned_docs/version-0.9.0/error-messaging.md","sourceDirName":".","slug":"/error-messaging","permalink":"/server/0.9.0/error-messaging","draft":false,"unlisted":false,"tags":[],"version":"0.9.0","frontMatter":{"id":"error-messaging","title":"Error messaging"},"sidebar":"tutorialSidebar","previous":{"title":"Mutations","permalink":"/server/0.9.0/mutations"},"next":{"title":"Custom scalars","permalink":"/server/0.9.0/scalars"}}'),s=n(74848),o=n(84429);let i={id:"error-messaging",title:"Error messaging"},a,l={},d=[{value:"Debugging errors",id:"debugging-errors",level:2},{value:"Replacing default error formatter",id:"replacing-default-error-formatter",level:2}];function c(e){let r={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(r.p,{children:["If you've experimented with GraphQL, you should be familiar that when things don't go according to plan, GraphQL servers include an additional key ",(0,s.jsx)(r.code,{children:"errors"})," in the returned response:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-json",children:'{\n    "errors": [\n        {\n            "message": "Variable \\"$input\\" got invalid value {}.\\nIn field \\"name\\": Expected \\"String!\\", found null.",\n            "locations": [\n                {\n                    "line": 1,\n                    "column": 21\n                }\n            ]\n        }\n    ]\n}\n'})}),"\n",(0,s.jsx)(r.p,{children:"Your first instinct when planning error messaging may be to use this approach to communicate custom errors (like permission or validation errors) raised by your resolvers."}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Don't do this."})}),"\n",(0,s.jsxs)(r.p,{children:["The ",(0,s.jsx)(r.code,{children:"errors"})," key is, by design, supposed to relay errors to other developers working with the API. Messages present under this key are technical in nature and shouldn't be displayed to your end users."]}),"\n",(0,s.jsx)(r.p,{children:"Instead, you should define custom fields that your queries and mutations will include in result sets, to relay eventual errors and problems to clients, like this:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-python",children:'type_def = """\n    type Mutation {\n        login(username: String!, password: String!) {\n            error: String\n            user: User\n        }\n    }\n"""\n'})}),"\n",(0,s.jsxs)(r.p,{children:["Depending on success or failure, your mutation resolver may return either an ",(0,s.jsx)(r.code,{children:"error"})," message to be displayed to the user, or ",(0,s.jsx)(r.code,{children:"user"})," that has been logged in. Your API result-handling logic may then interpret the response based on the content of those two keys, only falling back to the main ",(0,s.jsx)(r.code,{children:"errors"})," key to make sure there wasn't an error in query syntax, connection or application."]}),"\n",(0,s.jsxs)(r.p,{children:["Likewise, your ",(0,s.jsx)(r.code,{children:"Query"})," resolvers may return a requested object or ",(0,s.jsx)(r.code,{children:"None"})," that will then cause a message such as \"Requested item doesn't exist or you don't have permission to see it\" to be displayed to the user in place of the requested resource."]}),"\n",(0,s.jsx)(r.h2,{id:"debugging-errors",children:"Debugging errors"}),"\n",(0,s.jsxs)(r.p,{children:["By default individual ",(0,s.jsx)(r.code,{children:"errors"})," elements contain a very limited amount of information about errors occurring inside the resolvers, forcing a developer to search an application's logs for details about the error's possible causes."]}),"\n",(0,s.jsxs)(r.p,{children:["Developer experience can be improved by including ",(0,s.jsx)(r.code,{children:"debug=True"})," in the list of arguments passed to Ariadne's ",(0,s.jsx)(r.code,{children:"GraphQL"})," object:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-python",children:"app = GraphQL(schema, debug=True)\n"})}),"\n",(0,s.jsxs)(r.p,{children:["This will result in each error having an additional ",(0,s.jsx)(r.code,{children:"exception"})," key containing both a complete stacktrace and current context for which the error has occurred:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-json",children:'{\n    "errors": [\n        {\n            "message": "\'dict\' object has no attribute \'build_name\'",\n            "locations": [\n                [\n                    3,\n                    5\n                ]\n            ],\n            "path": [\n                "people",\n                0,\n                "fullName"\n            ],\n            "extensions": {\n                "exception": {\n                    "stacktrace": [\n                        "Traceback (most recent call last):",\n                        "  File \\"/Users/lib/python3.6/site-packages/graphql/execution/execute.py\\", line 619, in resolve_field_value_or_error",\n                        "    result = resolve_fn(source, info, **args)",\n                        "  File \\"myapp.py\\", line 40, in resolve_person_fullname",\n                        "    return get_person_fullname(person)",\n                        "  File \\"myapp.py\\", line 47, in get_person_fullname",\n                        "    return person.build_name()",\n                        "AttributeError: \'dict\' object has no attribute \'build_name\'"\n                    ],\n                    "context": {\n                        "person": "{\'firstName\': \'John\', \'lastName\': \'Doe\', \'age\': 21}"\n                    }\n                }\n            }\n        }\n    ]\n}\n'})}),"\n",(0,s.jsx)(r.h2,{id:"replacing-default-error-formatter",children:"Replacing default error formatter"}),"\n",(0,s.jsx)(r.p,{children:"The default error formatter used by Ariadne performs the following tasks:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Formats error by using its ",(0,s.jsx)(r.code,{children:"formatted"})," property."]}),"\n",(0,s.jsxs)(r.li,{children:["Unwraps ",(0,s.jsx)(r.code,{children:"GraphQL"})," error by accessing its ",(0,s.jsx)(r.code,{children:"original_error"})," property."]}),"\n",(0,s.jsxs)(r.li,{children:["If the unwrapped error is available and the ",(0,s.jsx)(r.code,{children:"debug"})," argument is set to ",(0,s.jsx)(r.code,{children:"True"}),", update the already formatted error to also include an ",(0,s.jsx)(r.code,{children:"extensions"})," entry with an ",(0,s.jsx)(r.code,{children:"exception"})," dictionary containing ",(0,s.jsx)(r.code,{children:"stacktrace"})," and ",(0,s.jsx)(r.code,{children:"context"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["If you wish to change or customize this behavior, you can define a custom function in the ",(0,s.jsx)(r.code,{children:"error_formatter"})," argument to a ",(0,s.jsx)(r.code,{children:"GraphQL"})," object:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-python",children:'from ariadne import format_error\n\ndef my_format_error(error: GraphQLError, debug: bool = False) -> dict:\n    if debug:\n        # If debug is enabled, reuse Ariadne\'s formatting logic (not required)\n        return format_error(error, debug)\n\n    # Create formatted error data\n    formatted = error.formatted\n    # Replace original error message with custom one\n    formatted["message"] = "INTERNAL SERVER ERROR"\n    return formatted\n\napp = GraphQL(schema, error_formatter=my_format_error)\n'})})]})}function u(e={}){let{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},84429:function(e,r,n){n.d(r,{R:()=>i,x:()=>a});var t=n(96540);let s={},o=t.createContext(s);function i(e){let r=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(o.Provider,{value:r},e.children)}}}]);